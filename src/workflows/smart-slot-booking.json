{
  "type": "workflow",
  "name": "Smart Slot Booking",
  "steps": [
    {
      "action_id": "shipment.inbound.detect",
      "inputs": {
        "booking.container.container_id": "{booking.container.container_id}",
        "booking.arrival_eta": "{booking.arrival_eta}",
        "booking.facility.port_code": "{booking.facility.port_code}"
      },
      "actor_type": "port_ops"
    },
    {
      "action_id": "slot.chain.suggest",
      "inputs": {
        "booking.container.container_id": "{booking.container.container_id}",
        "booking.arrival_eta": "{booking.arrival_eta}",
        "booking.requested_window": "{booking.requested_window}",
        "booking.slot_chain.stages": "{booking.slot_chain.stages}",
        "constraints.mode": "{constraints.mode}"
      },
      "actor_type": "port_ops"
    },
    {
      "action_id": "documents.check",
      "inputs": {
        "booking.shipment_id": "{booking.shipment_id}",
        "documents.required": "{documents.required}",
        "documents.blocking_rules": "{documents.blocking_rules}"
      },
      "actor_type": "compliance"
    },
    {
      "action_id": "approval.booking.request",
      "inputs": {
        "booking.shipment_id": "{booking.shipment_id}",
        "booking.requested_window": "{booking.requested_window}",
        "policy.approver_group": "{policy.approver_group}"
      },
      "actor_type": "operations"
    },
    {
      "action_id": "slot.chain.reserve",
      "inputs": {
        "booking.slot_chain.slot_chain_id": "{booking.slot_chain.slot_chain_id}",
        "resources": "{resources}"
      },
      "actor_type": "port_ops"
    },
    {
      "action_id": "slot.chain.confirm",
      "inputs": {
        "booking.slot_chain.slot_chain_id": "{booking.slot_chain.slot_chain_id}",
        "booking.requested_window": "{booking.requested_window}"
      },
      "actor_type": "port_ops"
    },
    {
      "action_id": "dispatch.driver.assign",
      "inputs": {
        "booking.container.container_id": "{booking.container.container_id}",
        "booking.slot_chain.slot_chain_id": "{booking.slot_chain.slot_chain_id}",
        "booking.carrier_id": "{booking.carrier_id}"
      },
      "actor_type": "dispatch"
    }
  ],
  "partial_failure_scenarios": [
    {
      "scenario": "Document validation succeeds but slot chain booking fails",
      "signals": [
        "documents_validated",
        "slot_chain_booking_error"
      ],
      "impact": "Shipment cleared but no confirmed slot",
      "resolution_path": "booking_failure_recovery"
    },
    {
      "scenario": "Slot chain reserved but driver assignment fails",
      "signals": [
        "slot_chain_reserved",
        "driver_assignment_failed"
      ],
      "impact": "Slot chain held without pickup plan",
      "resolution_path": "driver_assignment_recovery"
    }
  ],
  "resolution_paths": {
    "booking_failure_recovery": {
      "actions": [
        "Release tentative slot hold",
        "Retry booking with exponential backoff",
        "Escalate to operations for manual slot request"
      ],
      "fallback": "Route to manual booking queue",
      "owner": "Port Ops"
    },
    "driver_assignment_recovery": {
      "actions": [
        "Retry driver assignment",
        "Offer alternate pickup windows",
        "Notify carrier dispatch if no driver confirmed"
      ],
      "fallback": "Hold slot and mark pickup at risk",
      "owner": "Dispatch"
    }
  },
  "concurrency_locks": [
    {
      "resource": "container_move",
      "scope": "container_id",
      "lock_key": "container:{container_id}:move",
      "held_during_steps": [
        "slot.chain.suggest",
        "slot.chain.reserve",
        "slot.chain.confirm",
        "dispatch.driver.assign"
      ],
      "release_conditions": [
        "slot_chain_confirmed",
        "workflow_aborted"
      ]
    }
  ],
  "policy_references": {
    "resilience": "policies/resilience.json"
  }
}
