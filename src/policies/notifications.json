{
  "type": "regulation",
  "name": "Notification Policy",
  "policy": "notifications",
  "version": "1.0",
  "description": "Routing, severity, and escalation rules for port logistics alerts.",
  "channels": {
    "email": {
      "providers": ["ses", "sendgrid"],
      "supports_rich_content": true
    },
    "sms": {
      "providers": ["twilio"],
      "max_length": 160
    },
    "push": {
      "providers": ["firebase"],
      "supports_action_buttons": true
    },
    "webhook": {
      "providers": ["generic"],
      "retries": 3
    },
    "in_app": {
      "supports_action_buttons": true
    }
  },
  "severity_levels": {
    "info": {
      "sla_minutes": 60,
      "default_channels": ["in_app"]
    },
    "warning": {
      "sla_minutes": 30,
      "default_channels": ["in_app", "email"]
    },
    "critical": {
      "sla_minutes": 10,
      "default_channels": ["sms", "push", "in_app"]
    }
  },
  "time_of_day_windows": {
    "business_hours": {
      "timezone": "America/Los_Angeles",
      "days": ["mon", "tue", "wed", "thu", "fri"],
      "start": "06:00",
      "end": "18:00"
    },
    "after_hours": {
      "timezone": "America/Los_Angeles",
      "days": ["mon", "tue", "wed", "thu", "fri", "sat", "sun"],
      "start": "18:00",
      "end": "06:00"
    }
  },
  "routing_rules": [
    {
      "name": "Critical port delays",
      "match": {
        "event_type": "port_delay",
        "severity": "critical"
      },
      "route_to": ["dispatcher", "operations"],
      "channels": ["sms", "push", "in_app"],
      "required_ack_minutes": 10,
      "time_of_day": "after_hours"
    },
    {
      "name": "Compliance holds",
      "match": {
        "event_type": "compliance_hold",
        "severity": "warning"
      },
      "route_to": ["compliance"],
      "channels": ["email", "in_app"],
      "required_ack_minutes": 30,
      "time_of_day": "business_hours"
    },
    {
      "name": "Customer-impacting delays",
      "match": {
        "event_type": "port_delay",
        "tags": ["customer_impact"]
      },
      "route_to": ["customer_success"],
      "channels": ["email", "in_app"],
      "required_ack_minutes": 45,
      "time_of_day": "business_hours"
    }
  ],
  "booking_status_triggers": [
    {
      "name": "Booking placed on hold",
      "transition": {
        "from": ["requested", "confirmed"],
        "to": "held"
      },
      "event_type": "booking_hold",
      "channels": ["email", "in_app"],
      "template": "booking_hold_notice",
      "recipients": ["shipper_contact", "terminal_ops"]
    },
    {
      "name": "Booking confirmed",
      "transition": {
        "from": ["requested", "held"],
        "to": "confirmed"
      },
      "event_type": "booking_confirmed",
      "channels": ["email", "sms", "in_app"],
      "template": "booking_confirmed_notice",
      "recipients": ["shipper_contact", "carrier_dispatch", "terminal_ops"]
    },
    {
      "name": "Booking cancelled",
      "transition": {
        "from": ["requested", "held", "confirmed"],
        "to": "cancelled"
      },
      "event_type": "booking_cancelled",
      "channels": ["email", "sms", "in_app"],
      "template": "booking_cancelled_notice",
      "recipients": ["shipper_contact", "carrier_dispatch", "terminal_ops"]
    },
    {
      "name": "Booking marked as no-show",
      "transition": {
        "from": ["confirmed", "checked-in"],
        "to": "no-show"
      },
      "event_type": "booking_no_show",
      "channels": ["email", "sms", "in_app"],
      "template": "booking_no_show_notice",
      "recipients": ["shipper_contact", "carrier_dispatch", "terminal_ops", "billing"]
    }
  ],
  "event_triggers": [
    {
      "name": "Auto-rebook suggestion",
      "event_type": "auto_rebook_suggestion",
      "channels": ["email", "sms", "in_app"],
      "template": "auto_rebook_suggestion_notice",
      "recipients": ["shipper_contact", "carrier_dispatch", "terminal_ops"]
    }
  ],
  "scheduled_triggers": [
    {
      "name": "T-24 booking reminder",
      "relative_to": "slot_start",
      "offset_hours": 24,
      "direction": "before",
      "event_type": "booking_reminder",
      "channels": ["email", "sms", "in_app"],
      "template": "booking_reminder_t24",
      "recipients": ["shipper_contact", "carrier_dispatch"]
    },
    {
      "name": "T-3h booking reminder",
      "relative_to": "slot_start",
      "offset_hours": 3,
      "direction": "before",
      "event_type": "booking_reminder",
      "channels": ["sms", "in_app"],
      "template": "booking_reminder_t3h",
      "recipients": ["shipper_contact", "carrier_dispatch"]
    },
    {
      "name": "Go-to-gate window open notice",
      "relative_to": "go_to_gate_start",
      "offset_minutes": 0,
      "direction": "at",
      "event_type": "go_to_gate_window",
      "channels": ["sms", "in_app"],
      "template": "go_to_gate_window_notice",
      "recipients": ["carrier_dispatch", "terminal_ops"]
    },
    {
      "name": "Missing documents reminder",
      "relative_to": "document_due_at",
      "offset_hours": 24,
      "direction": "before",
      "event_type": "missing_documents",
      "channels": ["email", "sms", "in_app"],
      "template": "missing_documents_reminder",
      "recipients": ["shipper_contact"]
    }
  ],
  "templates": {
    "booking_hold_notice": {
      "subject": "Booking {{booking_number}} placed on hold",
      "body": "Booking {{booking_number}} is on hold pending documentation review. Hold expires at {{hold_expires_at}}."
    },
    "booking_confirmed_notice": {
      "subject": "Booking {{booking_number}} confirmed",
      "body": "Your booking is confirmed for {{slot_start}}–{{slot_end}} at {{terminal_name}} (Gate: {{gate_name}}). Slot chain: {{slot_chain_summary}}. Cutoff: {{cutoff_time}}. Entry pass QR: {{entry_pass_qr_url}}."
    },
    "booking_cancelled_notice": {
      "subject": "Booking {{booking_number}} cancelled",
      "body": "Booking {{booking_number}} was cancelled. Reason: {{cancel_reason}}."
    },
    "booking_no_show_notice": {
      "subject": "Booking {{booking_number}} marked no-show",
      "body": "Booking {{booking_number}} was marked as no-show at {{no_show_at}}. Contact operations for follow-up."
    },
    "booking_reminder_t24": {
      "subject": "Reminder: Booking {{booking_number}} in 24 hours",
      "body": "Your booking at {{terminal_name}} is scheduled for {{slot_start}}–{{slot_end}} tomorrow. Go-to-gate window: {{go_to_gate_start}}–{{go_to_gate_end}}. Missing documents: {{missing_documents}}. Cutoff: {{cutoff_time}}. Entry pass QR: {{entry_pass_qr_url}}."
    },
    "booking_reminder_t3h": {
      "subject": "Reminder: Booking {{booking_number}} in 3 hours",
      "body": "Your booking at {{terminal_name}} starts at {{slot_start}}. Go-to-gate window: {{go_to_gate_start}}–{{go_to_gate_end}}. Missing documents: {{missing_documents}}. Entry pass QR: {{entry_pass_qr_url}}."
    },
    "go_to_gate_window_notice": {
      "subject": "Go-to-gate window open for booking {{booking_number}}",
      "body": "The go-to-gate window is open from {{go_to_gate_start}} to {{go_to_gate_end}} for {{terminal_name}}. Proceed to gate when ready."
    },
    "missing_documents_reminder": {
      "subject": "Missing documents for booking {{booking_number}}",
      "body": "We are missing {{missing_documents}} for booking {{booking_number}}. Please upload by {{document_due_at}}. If not received by {{cancellation_deadline}}, the booking may be cancelled."
    },
    "auto_rebook_suggestion_notice": {
      "subject": "Action needed: alternate slots for booking {{booking_number}}",
      "body": "We identified disruption risk for booking {{booking_number}}. Suggested alternatives: {{rebook_option_1}}, {{rebook_option_2}}, {{rebook_option_3}}. Review and approve at {{rebook_approval_url}} before {{rebook_decision_deadline}}."
    }
  },
  "recipients": {
    "shipper_contact": {
      "role": "shipper_contact",
      "lookup": "booking.shipper.primary_contact",
      "channels": ["email", "sms"]
    },
    "carrier_dispatch": {
      "role": "carrier_dispatch",
      "lookup": "booking.carrier.dispatch_team",
      "channels": ["email", "sms", "in_app"]
    },
    "terminal_ops": {
      "role": "terminal_ops",
      "lookup": "terminal.ops_team",
      "channels": ["email", "in_app"]
    },
    "billing": {
      "role": "billing",
      "lookup": "organisation.billing_contact",
      "channels": ["email"]
    }
  },
  "deduplication": {
    "default_window_minutes": 30,
    "rules": [
      {
        "name": "Port delay repeat suppression",
        "match": {
          "event_type": "port_delay"
        },
        "window_minutes": 30,
        "strategy": "suppress_repeats"
      }
    ],
    "suppression": [
      {
        "name": "Maintenance blackout",
        "match": {
          "tag": "maintenance"
        },
        "suppress": true,
        "notes": "Suppress alerts during approved maintenance windows."
      }
    ]
  },
  "escalation_ladders": {
    "port_delay": {
      "stop_conditions": ["acknowledged", "resolved"],
      "levels": [
        {
          "level": 1,
          "role": "dispatcher",
          "after_minutes": 0,
          "channels": ["in_app", "sms"]
        },
        {
          "level": 2,
          "role": "operations",
          "after_minutes": 15,
          "channels": ["push", "email"]
        },
        {
          "level": 3,
          "role": "compliance",
          "after_minutes": 30,
          "channels": ["email"]
        },
        {
          "level": 4,
          "role": "customer_success",
          "after_minutes": 45,
          "channels": ["email", "in_app"]
        }
      ]
    }
  }
}
